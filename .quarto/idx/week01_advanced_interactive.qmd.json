{"title":"Classical Linear Regression Model & Ordinary Least Squares","markdown":{"yaml":{"title":"Classical Linear Regression Model & Ordinary Least Squares","format":{"html":{"toc":true,"toc-depth":3,"number-sections":true,"code-fold":true,"theme":"cosmo","css":"styles.css"}},"execute":{"echo":true,"warning":false,"message":false}},"headingText":"Two variable linear regression analysis","containsRefs":false,"markdown":"\n\n::: callout-note\n[Download PDF](week01.pdf)\n:::\n\n\n## Readings\n\n- Stock and Watson (2003), Chapters 4‚Äì5\n- Dougherty (2016), Chapter 2\n- Wooldridge (2013), Chapter 2\n\n# Introduction\n\nEconometrics means economic measurement. Econometricians attempt to quantify\neconomic relationships that are of interest to theory and policy.\n\n# Correlation vs Regression\n\n## Correlation\n\nIn economics we are interested in the relationship between two or more random\nvariables, for example:\n\n- Sales and advertising expenditure\n- Personal consumption and disposable income\n- Investment and interest rates\n- Earnings and schooling\n\nA measure of linear association between two random variables $x$ and $y$\nis the **covariance**, which for a sample of $n$ pairs of observations\n$(x_1, y_1)$, $\\ldots$, $(x_n, y_n)$ is calculated as\n\n$$\n\\operatorname{cov}(x,y)\n=\n\\frac{1}{n-1}\n\\sum_{i=1}^{n}\n(x_i - \\bar{x})(y_i - \\bar{y})\n$$\n\nThe covariance is a measure of **linear** association. It may be approximately\nzero even when there is a strong non-linear (e.g. quadratic) relationship.\n\n## Interactive Correlation Explorer\n\n::: {.callout-tip}\n## Explore Correlation Interactively!\nAdjust the sliders below to see how different parameters affect the relationship between variables. This hands-on exploration helps build intuition for regression concepts.\n:::\n\n```{r}\n#| echo: false\n#| message: false\n#| warning: false\n\nlibrary(plotly)\nlibrary(htmltools)\n\n# Create HTML controls and interactive plot\nhtmltools::browsable(\n  tagList(\n    tags$div(\n      style = \"max-width: 1200px; margin: 0 auto; padding: 20px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); border-radius: 15px; box-shadow: 0 10px 30px rgba(0,0,0,0.2);\",\n      \n      tags$div(\n        style = \"background: white; padding: 25px; border-radius: 10px; margin-bottom: 20px;\",\n        \n        tags$h3(\n          \"üéÆ Control Panel\",\n          style = \"margin-top: 0; color: #667eea; font-weight: 700;\"\n        ),\n        \n        tags$div(\n          style = \"display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px; margin-top: 20px;\",\n          \n          # Correlation slider\n          tags$div(\n            tags$label(\n              \"üìä Correlation (œÅ)\",\n              style = \"font-weight: 600; color: #333; display: block; margin-bottom: 8px;\"\n            ),\n            tags$input(\n              type = \"range\",\n              id = \"correlation\",\n              min = \"-1\",\n              max = \"1\",\n              step = \"0.1\",\n              value = \"0.7\",\n              style = \"width: 100%; height: 8px; border-radius: 5px; background: linear-gradient(90deg, #f44336 0%, #ffc107 50%, #4caf50 100%);\"\n            ),\n            tags$div(\n              id = \"corrValue\",\n              \"0.7\",\n              style = \"text-align: center; margin-top: 5px; font-weight: 700; color: #667eea; font-size: 18px;\"\n            )\n          ),\n          \n          # Sample size slider\n          tags$div(\n            tags$label(\n              \"üë• Sample Size (n)\",\n              style = \"font-weight: 600; color: #333; display: block; margin-bottom: 8px;\"\n            ),\n            tags$input(\n              type = \"range\",\n              id = \"sampleSize\",\n              min = \"20\",\n              max = \"500\",\n              step = \"10\",\n              value = \"100\",\n              style = \"width: 100%;\"\n            ),\n            tags$div(\n              id = \"sizeValue\",\n              \"100\",\n              style = \"text-align: center; margin-top: 5px; font-weight: 700; color: #667eea; font-size: 18px;\"\n            )\n          ),\n          \n          # Noise slider\n          tags$div(\n            tags$label(\n              \"üîä Noise Level (œÉ)\",\n              style = \"font-weight: 600; color: #333; display: block; margin-bottom: 8px;\"\n            ),\n            tags$input(\n              type = \"range\",\n              id = \"noise\",\n              min = \"0.1\",\n              max = \"2\",\n              step = \"0.1\",\n              value = \"0.5\",\n              style = \"width: 100%;\"\n            ),\n            tags$div(\n              id = \"noiseValue\",\n              \"0.5\",\n              style = \"text-align: center; margin-top: 5px; font-weight: 700; color: #667eea; font-size: 18px;\"\n            )\n          )\n        ),\n        \n        tags$div(\n          style = \"margin-top: 20px; display: flex; gap: 10px; flex-wrap: wrap;\",\n          tags$button(\n            \"üé≤ Regenerate Data\",\n            id = \"regenerate\",\n            onclick = \"updatePlot()\",\n            style = \"padding: 12px 24px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; border: none; border-radius: 8px; font-weight: 600; cursor: pointer; box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4); transition: all 0.3s;\"\n          ),\n          tags$button(\n            \"üìà Show Regression Stats\",\n            id = \"showStats\",\n            onclick = \"toggleStats()\",\n            style = \"padding: 12px 24px; background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%); color: white; border: none; border-radius: 8px; font-weight: 600; cursor: pointer; box-shadow: 0 4px 15px rgba(245, 87, 108, 0.4); transition: all 0.3s;\"\n          )\n        )\n      ),\n      \n      # Plot container\n      tags$div(\n        id = \"plotContainer\",\n        style = \"background: white; padding: 20px; border-radius: 10px; box-shadow: 0 5px 20px rgba(0,0,0,0.1);\"\n      ),\n      \n      # Stats container\n      tags$div(\n        id = \"statsContainer\",\n        style = \"background: white; padding: 20px; border-radius: 10px; margin-top: 20px; display: none;\",\n        tags$h4(\"üìä Regression Statistics\", style = \"color: #667eea; margin-top: 0;\"),\n        tags$div(id = \"statsContent\")\n      )\n    ),\n    \n    # JavaScript for interactivity\n    tags$script(HTML(\"\n      // Initialize\n      let currentData = null;\n      \n      function generateData() {\n        const n = parseInt(document.getElementById('sampleSize').value);\n        const rho = parseFloat(document.getElementById('correlation').value);\n        const sigma = parseFloat(document.getElementById('noise').value);\n        \n        const x = [];\n        const y = [];\n        \n        // Generate random normal data\n        for (let i = 0; i < n; i++) {\n          const xi = (Math.random() + Math.random() + Math.random() + Math.random() - 2) * 1.5;\n          const noise = (Math.random() + Math.random() + Math.random() + Math.random() - 2) * sigma;\n          x.push(xi);\n          y.push(rho * xi + noise);\n        }\n        \n        return {x, y, n, rho, sigma};\n      }\n      \n      function calculateRegression(x, y) {\n        const n = x.length;\n        const sumX = x.reduce((a, b) => a + b, 0);\n        const sumY = y.reduce((a, b) => a + b, 0);\n        const sumXY = x.reduce((sum, xi, i) => sum + xi * y[i], 0);\n        const sumX2 = x.reduce((sum, xi) => sum + xi * xi, 0);\n        \n        const meanX = sumX / n;\n        const meanY = sumY / n;\n        \n        const beta1 = (sumXY - n * meanX * meanY) / (sumX2 - n * meanX * meanX);\n        const beta0 = meanY - beta1 * meanX;\n        \n        // Calculate R-squared\n        const yPred = x.map(xi => beta0 + beta1 * xi);\n        const ssRes = y.reduce((sum, yi, i) => sum + Math.pow(yi - yPred[i], 2), 0);\n        const ssTot = y.reduce((sum, yi) => sum + Math.pow(yi - meanY, 2), 0);\n        const r2 = 1 - (ssRes / ssTot);\n        \n        // Calculate correlation\n        const corrNumerator = x.reduce((sum, xi, i) => sum + (xi - meanX) * (y[i] - meanY), 0);\n        const corrDenomX = Math.sqrt(x.reduce((sum, xi) => sum + Math.pow(xi - meanX, 2), 0));\n        const corrDenomY = Math.sqrt(y.reduce((sum, yi) => sum + Math.pow(yi - meanY, 2), 0));\n        const corr = corrNumerator / (corrDenomX * corrDenomY);\n        \n        return {beta0, beta1, r2, corr, yPred};\n      }\n      \n      function updatePlot() {\n        currentData = generateData();\n        const {x, y, n, rho, sigma} = currentData;\n        const {beta0, beta1, r2, corr, yPred} = calculateRegression(x, y);\n        \n        const trace1 = {\n          x: x,\n          y: y,\n          mode: 'markers',\n          type: 'scatter',\n          name: 'Data Points',\n          marker: {\n            size: 10,\n            color: '#667eea',\n            opacity: 0.6,\n            line: {\n              color: 'white',\n              width: 2\n            }\n          },\n          hovertemplate: '<b>X:</b> %{x:.2f}<br><b>Y:</b> %{y:.2f}<extra></extra>'\n        };\n        \n        const trace2 = {\n          x: x,\n          y: yPred,\n          mode: 'lines',\n          type: 'scatter',\n          name: 'Regression Line',\n          line: {\n            color: '#f5576c',\n            width: 3\n          },\n          hovertemplate: '<b>Predicted Y:</b> %{y:.2f}<extra></extra>'\n        };\n        \n        const layout = {\n          title: {\n            text: `<b>Correlation Explorer</b><br><sub>œÅ=${rho.toFixed(2)}, n=${n}, R¬≤=${r2.toFixed(3)}</sub>`,\n            font: {size: 20}\n          },\n          xaxis: {\n            title: '<b>X Variable</b>',\n            gridcolor: '#f0f0f0',\n            zeroline: true,\n            zerolinecolor: '#999'\n          },\n          yaxis: {\n            title: '<b>Y Variable</b>',\n            gridcolor: '#f0f0f0',\n            zeroline: true,\n            zerolinecolor: '#999'\n          },\n          plot_bgcolor: '#fafafa',\n          paper_bgcolor: 'white',\n          hovermode: 'closest',\n          showlegend: true,\n          legend: {\n            x: 0.02,\n            y: 0.98,\n            bgcolor: 'rgba(255,255,255,0.9)',\n            bordercolor: '#ddd',\n            borderwidth: 1\n          }\n        };\n        \n        const config = {\n          displayModeBar: true,\n          displaylogo: false,\n          modeBarButtonsToRemove: ['lasso2d', 'select2d']\n        };\n        \n        Plotly.newPlot('plotContainer', [trace1, trace2], layout, config);\n        \n        // Update stats\n        updateStats(beta0, beta1, r2, corr, n);\n      }\n      \n      function updateStats(beta0, beta1, r2, corr, n) {\n        const statsHTML = `\n          <div style='display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px;'>\n            <div style='padding: 15px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); border-radius: 8px; color: white;'>\n              <div style='font-size: 12px; opacity: 0.9;'>Intercept (Œ≤‚ÇÄ)</div>\n              <div style='font-size: 24px; font-weight: 700;'>${beta0.toFixed(3)}</div>\n            </div>\n            <div style='padding: 15px; background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%); border-radius: 8px; color: white;'>\n              <div style='font-size: 12px; opacity: 0.9;'>Slope (Œ≤‚ÇÅ)</div>\n              <div style='font-size: 24px; font-weight: 700;'>${beta1.toFixed(3)}</div>\n            </div>\n            <div style='padding: 15px; background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%); border-radius: 8px; color: white;'>\n              <div style='font-size: 12px; opacity: 0.9;'>R-squared</div>\n              <div style='font-size: 24px; font-weight: 700;'>${r2.toFixed(3)}</div>\n            </div>\n            <div style='padding: 15px; background: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%); border-radius: 8px; color: white;'>\n              <div style='font-size: 12px; opacity: 0.9;'>Correlation</div>\n              <div style='font-size: 24px; font-weight: 700;'>${corr.toFixed(3)}</div>\n            </div>\n          </div>\n          <div style='margin-top: 20px; padding: 15px; background: #f5f5f5; border-radius: 8px; border-left: 4px solid #667eea;'>\n            <strong>Regression Equation:</strong> \n            <code style='background: white; padding: 5px 10px; border-radius: 4px; display: inline-block; margin-top: 5px;'>\n              Y = ${beta0.toFixed(3)} + ${beta1.toFixed(3)}¬∑X\n            </code>\n          </div>\n        `;\n        document.getElementById('statsContent').innerHTML = statsHTML;\n      }\n      \n      function toggleStats() {\n        const container = document.getElementById('statsContainer');\n        container.style.display = container.style.display === 'none' ? 'block' : 'none';\n      }\n      \n      // Event listeners\n      document.getElementById('correlation').addEventListener('input', function(e) {\n        document.getElementById('corrValue').textContent = e.target.value;\n      });\n      \n      document.getElementById('sampleSize').addEventListener('input', function(e) {\n        document.getElementById('sizeValue').textContent = e.target.value;\n      });\n      \n      document.getElementById('noise').addEventListener('input', function(e) {\n        document.getElementById('noiseValue').textContent = e.target.value;\n      });\n      \n      // Initialize plot\n      updatePlot();\n    \"))\n  )\n)\n```\n\n::: {.callout-note}\n## üéì Learning Objectives\n- **Experiment** with correlation strength to see how it affects scatter patterns\n- **Observe** how sample size influences the precision of estimates\n- **Understand** the role of noise (random error) in obscuring relationships\n- **Compare** the actual correlation with the estimated R-squared value\n:::\n\n## Understanding Different Correlation Patterns\n\n```{r}\n#| echo: false\n#| fig-width: 10\n#| fig-height: 6\n\nlibrary(plotly)\n\n# Generate data for different correlation scenarios\nset.seed(456)\nscenarios <- list(\n  list(name = \"Strong Positive (r=0.9)\", rho = 0.9, color = \"#43e97b\"),\n  list(name = \"Moderate Positive (r=0.5)\", rho = 0.5, color = \"#4facfe\"),\n  list(name = \"No Correlation (r=0)\", rho = 0, color = \"#f5576c\"),\n  list(name = \"Moderate Negative (r=-0.5)\", rho = -0.5, color = \"#f093fb\"),\n  list(name = \"Strong Negative (r=-0.9)\", rho = -0.9, color = \"#764ba2\")\n)\n\nfig <- plot_ly()\n\nfor (scenario in scenarios) {\n  x <- rnorm(80)\n  y <- scenario$rho * x + rnorm(80, sd = 0.4)\n  \n  fig <- fig %>%\n    add_trace(\n      x = x,\n      y = y,\n      type = 'scatter',\n      mode = 'markers',\n      name = scenario$name,\n      marker = list(\n        size = 8,\n        color = scenario$color,\n        opacity = 0.6,\n        line = list(color = 'white', width = 1)\n      ),\n      hovertemplate = paste0(\n        '<b>', scenario$name, '</b><br>',\n        'X: %{x:.2f}<br>',\n        'Y: %{y:.2f}<extra></extra>'\n      )\n    )\n}\n\nfig <- fig %>%\n  layout(\n    title = list(\n      text = '<b>Comparing Different Correlation Strengths</b>',\n      font = list(size = 18)\n    ),\n    xaxis = list(title = '<b>X Variable</b>', gridcolor = '#f0f0f0'),\n    yaxis = list(title = '<b>Y Variable</b>', gridcolor = '#f0f0f0'),\n    plot_bgcolor = '#fafafa',\n    paper_bgcolor = 'white',\n    hovermode = 'closest',\n    legend = list(\n      orientation = 'h',\n      y = -0.15,\n      x = 0.5,\n      xanchor = 'center'\n    )\n  )\n\nfig\n```\n\n## Overview\n\nIn this handout we will revisit the Classical Linear Regression Model (CLRM) [see @wooldridge2010, chap. 1-2]. The goal of this week's lecture is to:\n\n1. understand the model specification;\n2. its underlying assumptions;\n3. and the appropriate interpretation;\n4. the OLS estimator, using linear algebra;\n5. the geometry of OLS and partitioned regression result.\n\n## Model Specification\n\nThe linear population regression model is given by,\n\n$$ \n\\begin{aligned}\n  Y_i =& X_i'\\beta+\\varepsilon_i \\\\\n  =& \\beta_1\\mathbf{1}+\\beta_2X_{i2}+\\beta_3X_{i3}+...+\\beta_kX_{ik}+\\varepsilon_i\n\\end{aligned}\n$$\n\n# R Code Example\n\n```{r}\n#| eval: false\n\n# In R you must install the appropriate package. Having installed the package\n# you must load the library associated with that package each time you enter R.\n# I used the following libraries over Term 1:\nlibrary(tidyverse)\nlibrary(reshape2)\nlibrary(foreign)\nlibrary(ggplot2)\nlibrary(haven)\nlibrary(readxl)\n\n# Read the Stata dataset qlfs18.dta\nqlfs18 <- read_dta(\"qlfs1314_2.dta\")\n\n# Converting some variable names written in capitals\nnames(qlfs18)[names(qlfs18) == \"EDAGE\"]   <- \"edage\"\nnames(qlfs18)[names(qlfs18) == \"HOURPAY\"] <- \"hourpay\"\nnames(qlfs18)[names(qlfs18) == \"AGE\"]     <- \"age\"\n\n# Plot a histogram of hourpay (with 30 bins)\nggplot(qlfs18, aes(x = hourpay)) +\n  geom_histogram(binwidth = 30)\n\n# Due to asymmetric distribution use ln(hourpay)\nqlfs18 <- qlfs18 %>%\n  mutate(lhourpay = log(hourpay))\n```\n","srcMarkdownNoYaml":"\n\n::: callout-note\n[Download PDF](week01.pdf)\n:::\n\n# Two variable linear regression analysis\n\n## Readings\n\n- Stock and Watson (2003), Chapters 4‚Äì5\n- Dougherty (2016), Chapter 2\n- Wooldridge (2013), Chapter 2\n\n# Introduction\n\nEconometrics means economic measurement. Econometricians attempt to quantify\neconomic relationships that are of interest to theory and policy.\n\n# Correlation vs Regression\n\n## Correlation\n\nIn economics we are interested in the relationship between two or more random\nvariables, for example:\n\n- Sales and advertising expenditure\n- Personal consumption and disposable income\n- Investment and interest rates\n- Earnings and schooling\n\nA measure of linear association between two random variables $x$ and $y$\nis the **covariance**, which for a sample of $n$ pairs of observations\n$(x_1, y_1)$, $\\ldots$, $(x_n, y_n)$ is calculated as\n\n$$\n\\operatorname{cov}(x,y)\n=\n\\frac{1}{n-1}\n\\sum_{i=1}^{n}\n(x_i - \\bar{x})(y_i - \\bar{y})\n$$\n\nThe covariance is a measure of **linear** association. It may be approximately\nzero even when there is a strong non-linear (e.g. quadratic) relationship.\n\n## Interactive Correlation Explorer\n\n::: {.callout-tip}\n## Explore Correlation Interactively!\nAdjust the sliders below to see how different parameters affect the relationship between variables. This hands-on exploration helps build intuition for regression concepts.\n:::\n\n```{r}\n#| echo: false\n#| message: false\n#| warning: false\n\nlibrary(plotly)\nlibrary(htmltools)\n\n# Create HTML controls and interactive plot\nhtmltools::browsable(\n  tagList(\n    tags$div(\n      style = \"max-width: 1200px; margin: 0 auto; padding: 20px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); border-radius: 15px; box-shadow: 0 10px 30px rgba(0,0,0,0.2);\",\n      \n      tags$div(\n        style = \"background: white; padding: 25px; border-radius: 10px; margin-bottom: 20px;\",\n        \n        tags$h3(\n          \"üéÆ Control Panel\",\n          style = \"margin-top: 0; color: #667eea; font-weight: 700;\"\n        ),\n        \n        tags$div(\n          style = \"display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px; margin-top: 20px;\",\n          \n          # Correlation slider\n          tags$div(\n            tags$label(\n              \"üìä Correlation (œÅ)\",\n              style = \"font-weight: 600; color: #333; display: block; margin-bottom: 8px;\"\n            ),\n            tags$input(\n              type = \"range\",\n              id = \"correlation\",\n              min = \"-1\",\n              max = \"1\",\n              step = \"0.1\",\n              value = \"0.7\",\n              style = \"width: 100%; height: 8px; border-radius: 5px; background: linear-gradient(90deg, #f44336 0%, #ffc107 50%, #4caf50 100%);\"\n            ),\n            tags$div(\n              id = \"corrValue\",\n              \"0.7\",\n              style = \"text-align: center; margin-top: 5px; font-weight: 700; color: #667eea; font-size: 18px;\"\n            )\n          ),\n          \n          # Sample size slider\n          tags$div(\n            tags$label(\n              \"üë• Sample Size (n)\",\n              style = \"font-weight: 600; color: #333; display: block; margin-bottom: 8px;\"\n            ),\n            tags$input(\n              type = \"range\",\n              id = \"sampleSize\",\n              min = \"20\",\n              max = \"500\",\n              step = \"10\",\n              value = \"100\",\n              style = \"width: 100%;\"\n            ),\n            tags$div(\n              id = \"sizeValue\",\n              \"100\",\n              style = \"text-align: center; margin-top: 5px; font-weight: 700; color: #667eea; font-size: 18px;\"\n            )\n          ),\n          \n          # Noise slider\n          tags$div(\n            tags$label(\n              \"üîä Noise Level (œÉ)\",\n              style = \"font-weight: 600; color: #333; display: block; margin-bottom: 8px;\"\n            ),\n            tags$input(\n              type = \"range\",\n              id = \"noise\",\n              min = \"0.1\",\n              max = \"2\",\n              step = \"0.1\",\n              value = \"0.5\",\n              style = \"width: 100%;\"\n            ),\n            tags$div(\n              id = \"noiseValue\",\n              \"0.5\",\n              style = \"text-align: center; margin-top: 5px; font-weight: 700; color: #667eea; font-size: 18px;\"\n            )\n          )\n        ),\n        \n        tags$div(\n          style = \"margin-top: 20px; display: flex; gap: 10px; flex-wrap: wrap;\",\n          tags$button(\n            \"üé≤ Regenerate Data\",\n            id = \"regenerate\",\n            onclick = \"updatePlot()\",\n            style = \"padding: 12px 24px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; border: none; border-radius: 8px; font-weight: 600; cursor: pointer; box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4); transition: all 0.3s;\"\n          ),\n          tags$button(\n            \"üìà Show Regression Stats\",\n            id = \"showStats\",\n            onclick = \"toggleStats()\",\n            style = \"padding: 12px 24px; background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%); color: white; border: none; border-radius: 8px; font-weight: 600; cursor: pointer; box-shadow: 0 4px 15px rgba(245, 87, 108, 0.4); transition: all 0.3s;\"\n          )\n        )\n      ),\n      \n      # Plot container\n      tags$div(\n        id = \"plotContainer\",\n        style = \"background: white; padding: 20px; border-radius: 10px; box-shadow: 0 5px 20px rgba(0,0,0,0.1);\"\n      ),\n      \n      # Stats container\n      tags$div(\n        id = \"statsContainer\",\n        style = \"background: white; padding: 20px; border-radius: 10px; margin-top: 20px; display: none;\",\n        tags$h4(\"üìä Regression Statistics\", style = \"color: #667eea; margin-top: 0;\"),\n        tags$div(id = \"statsContent\")\n      )\n    ),\n    \n    # JavaScript for interactivity\n    tags$script(HTML(\"\n      // Initialize\n      let currentData = null;\n      \n      function generateData() {\n        const n = parseInt(document.getElementById('sampleSize').value);\n        const rho = parseFloat(document.getElementById('correlation').value);\n        const sigma = parseFloat(document.getElementById('noise').value);\n        \n        const x = [];\n        const y = [];\n        \n        // Generate random normal data\n        for (let i = 0; i < n; i++) {\n          const xi = (Math.random() + Math.random() + Math.random() + Math.random() - 2) * 1.5;\n          const noise = (Math.random() + Math.random() + Math.random() + Math.random() - 2) * sigma;\n          x.push(xi);\n          y.push(rho * xi + noise);\n        }\n        \n        return {x, y, n, rho, sigma};\n      }\n      \n      function calculateRegression(x, y) {\n        const n = x.length;\n        const sumX = x.reduce((a, b) => a + b, 0);\n        const sumY = y.reduce((a, b) => a + b, 0);\n        const sumXY = x.reduce((sum, xi, i) => sum + xi * y[i], 0);\n        const sumX2 = x.reduce((sum, xi) => sum + xi * xi, 0);\n        \n        const meanX = sumX / n;\n        const meanY = sumY / n;\n        \n        const beta1 = (sumXY - n * meanX * meanY) / (sumX2 - n * meanX * meanX);\n        const beta0 = meanY - beta1 * meanX;\n        \n        // Calculate R-squared\n        const yPred = x.map(xi => beta0 + beta1 * xi);\n        const ssRes = y.reduce((sum, yi, i) => sum + Math.pow(yi - yPred[i], 2), 0);\n        const ssTot = y.reduce((sum, yi) => sum + Math.pow(yi - meanY, 2), 0);\n        const r2 = 1 - (ssRes / ssTot);\n        \n        // Calculate correlation\n        const corrNumerator = x.reduce((sum, xi, i) => sum + (xi - meanX) * (y[i] - meanY), 0);\n        const corrDenomX = Math.sqrt(x.reduce((sum, xi) => sum + Math.pow(xi - meanX, 2), 0));\n        const corrDenomY = Math.sqrt(y.reduce((sum, yi) => sum + Math.pow(yi - meanY, 2), 0));\n        const corr = corrNumerator / (corrDenomX * corrDenomY);\n        \n        return {beta0, beta1, r2, corr, yPred};\n      }\n      \n      function updatePlot() {\n        currentData = generateData();\n        const {x, y, n, rho, sigma} = currentData;\n        const {beta0, beta1, r2, corr, yPred} = calculateRegression(x, y);\n        \n        const trace1 = {\n          x: x,\n          y: y,\n          mode: 'markers',\n          type: 'scatter',\n          name: 'Data Points',\n          marker: {\n            size: 10,\n            color: '#667eea',\n            opacity: 0.6,\n            line: {\n              color: 'white',\n              width: 2\n            }\n          },\n          hovertemplate: '<b>X:</b> %{x:.2f}<br><b>Y:</b> %{y:.2f}<extra></extra>'\n        };\n        \n        const trace2 = {\n          x: x,\n          y: yPred,\n          mode: 'lines',\n          type: 'scatter',\n          name: 'Regression Line',\n          line: {\n            color: '#f5576c',\n            width: 3\n          },\n          hovertemplate: '<b>Predicted Y:</b> %{y:.2f}<extra></extra>'\n        };\n        \n        const layout = {\n          title: {\n            text: `<b>Correlation Explorer</b><br><sub>œÅ=${rho.toFixed(2)}, n=${n}, R¬≤=${r2.toFixed(3)}</sub>`,\n            font: {size: 20}\n          },\n          xaxis: {\n            title: '<b>X Variable</b>',\n            gridcolor: '#f0f0f0',\n            zeroline: true,\n            zerolinecolor: '#999'\n          },\n          yaxis: {\n            title: '<b>Y Variable</b>',\n            gridcolor: '#f0f0f0',\n            zeroline: true,\n            zerolinecolor: '#999'\n          },\n          plot_bgcolor: '#fafafa',\n          paper_bgcolor: 'white',\n          hovermode: 'closest',\n          showlegend: true,\n          legend: {\n            x: 0.02,\n            y: 0.98,\n            bgcolor: 'rgba(255,255,255,0.9)',\n            bordercolor: '#ddd',\n            borderwidth: 1\n          }\n        };\n        \n        const config = {\n          displayModeBar: true,\n          displaylogo: false,\n          modeBarButtonsToRemove: ['lasso2d', 'select2d']\n        };\n        \n        Plotly.newPlot('plotContainer', [trace1, trace2], layout, config);\n        \n        // Update stats\n        updateStats(beta0, beta1, r2, corr, n);\n      }\n      \n      function updateStats(beta0, beta1, r2, corr, n) {\n        const statsHTML = `\n          <div style='display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px;'>\n            <div style='padding: 15px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); border-radius: 8px; color: white;'>\n              <div style='font-size: 12px; opacity: 0.9;'>Intercept (Œ≤‚ÇÄ)</div>\n              <div style='font-size: 24px; font-weight: 700;'>${beta0.toFixed(3)}</div>\n            </div>\n            <div style='padding: 15px; background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%); border-radius: 8px; color: white;'>\n              <div style='font-size: 12px; opacity: 0.9;'>Slope (Œ≤‚ÇÅ)</div>\n              <div style='font-size: 24px; font-weight: 700;'>${beta1.toFixed(3)}</div>\n            </div>\n            <div style='padding: 15px; background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%); border-radius: 8px; color: white;'>\n              <div style='font-size: 12px; opacity: 0.9;'>R-squared</div>\n              <div style='font-size: 24px; font-weight: 700;'>${r2.toFixed(3)}</div>\n            </div>\n            <div style='padding: 15px; background: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%); border-radius: 8px; color: white;'>\n              <div style='font-size: 12px; opacity: 0.9;'>Correlation</div>\n              <div style='font-size: 24px; font-weight: 700;'>${corr.toFixed(3)}</div>\n            </div>\n          </div>\n          <div style='margin-top: 20px; padding: 15px; background: #f5f5f5; border-radius: 8px; border-left: 4px solid #667eea;'>\n            <strong>Regression Equation:</strong> \n            <code style='background: white; padding: 5px 10px; border-radius: 4px; display: inline-block; margin-top: 5px;'>\n              Y = ${beta0.toFixed(3)} + ${beta1.toFixed(3)}¬∑X\n            </code>\n          </div>\n        `;\n        document.getElementById('statsContent').innerHTML = statsHTML;\n      }\n      \n      function toggleStats() {\n        const container = document.getElementById('statsContainer');\n        container.style.display = container.style.display === 'none' ? 'block' : 'none';\n      }\n      \n      // Event listeners\n      document.getElementById('correlation').addEventListener('input', function(e) {\n        document.getElementById('corrValue').textContent = e.target.value;\n      });\n      \n      document.getElementById('sampleSize').addEventListener('input', function(e) {\n        document.getElementById('sizeValue').textContent = e.target.value;\n      });\n      \n      document.getElementById('noise').addEventListener('input', function(e) {\n        document.getElementById('noiseValue').textContent = e.target.value;\n      });\n      \n      // Initialize plot\n      updatePlot();\n    \"))\n  )\n)\n```\n\n::: {.callout-note}\n## üéì Learning Objectives\n- **Experiment** with correlation strength to see how it affects scatter patterns\n- **Observe** how sample size influences the precision of estimates\n- **Understand** the role of noise (random error) in obscuring relationships\n- **Compare** the actual correlation with the estimated R-squared value\n:::\n\n## Understanding Different Correlation Patterns\n\n```{r}\n#| echo: false\n#| fig-width: 10\n#| fig-height: 6\n\nlibrary(plotly)\n\n# Generate data for different correlation scenarios\nset.seed(456)\nscenarios <- list(\n  list(name = \"Strong Positive (r=0.9)\", rho = 0.9, color = \"#43e97b\"),\n  list(name = \"Moderate Positive (r=0.5)\", rho = 0.5, color = \"#4facfe\"),\n  list(name = \"No Correlation (r=0)\", rho = 0, color = \"#f5576c\"),\n  list(name = \"Moderate Negative (r=-0.5)\", rho = -0.5, color = \"#f093fb\"),\n  list(name = \"Strong Negative (r=-0.9)\", rho = -0.9, color = \"#764ba2\")\n)\n\nfig <- plot_ly()\n\nfor (scenario in scenarios) {\n  x <- rnorm(80)\n  y <- scenario$rho * x + rnorm(80, sd = 0.4)\n  \n  fig <- fig %>%\n    add_trace(\n      x = x,\n      y = y,\n      type = 'scatter',\n      mode = 'markers',\n      name = scenario$name,\n      marker = list(\n        size = 8,\n        color = scenario$color,\n        opacity = 0.6,\n        line = list(color = 'white', width = 1)\n      ),\n      hovertemplate = paste0(\n        '<b>', scenario$name, '</b><br>',\n        'X: %{x:.2f}<br>',\n        'Y: %{y:.2f}<extra></extra>'\n      )\n    )\n}\n\nfig <- fig %>%\n  layout(\n    title = list(\n      text = '<b>Comparing Different Correlation Strengths</b>',\n      font = list(size = 18)\n    ),\n    xaxis = list(title = '<b>X Variable</b>', gridcolor = '#f0f0f0'),\n    yaxis = list(title = '<b>Y Variable</b>', gridcolor = '#f0f0f0'),\n    plot_bgcolor = '#fafafa',\n    paper_bgcolor = 'white',\n    hovermode = 'closest',\n    legend = list(\n      orientation = 'h',\n      y = -0.15,\n      x = 0.5,\n      xanchor = 'center'\n    )\n  )\n\nfig\n```\n\n## Overview\n\nIn this handout we will revisit the Classical Linear Regression Model (CLRM) [see @wooldridge2010, chap. 1-2]. The goal of this week's lecture is to:\n\n1. understand the model specification;\n2. its underlying assumptions;\n3. and the appropriate interpretation;\n4. the OLS estimator, using linear algebra;\n5. the geometry of OLS and partitioned regression result.\n\n## Model Specification\n\nThe linear population regression model is given by,\n\n$$ \n\\begin{aligned}\n  Y_i =& X_i'\\beta+\\varepsilon_i \\\\\n  =& \\beta_1\\mathbf{1}+\\beta_2X_{i2}+\\beta_3X_{i3}+...+\\beta_kX_{ik}+\\varepsilon_i\n\\end{aligned}\n$$\n\n# R Code Example\n\n```{r}\n#| eval: false\n\n# In R you must install the appropriate package. Having installed the package\n# you must load the library associated with that package each time you enter R.\n# I used the following libraries over Term 1:\nlibrary(tidyverse)\nlibrary(reshape2)\nlibrary(foreign)\nlibrary(ggplot2)\nlibrary(haven)\nlibrary(readxl)\n\n# Read the Stata dataset qlfs18.dta\nqlfs18 <- read_dta(\"qlfs1314_2.dta\")\n\n# Converting some variable names written in capitals\nnames(qlfs18)[names(qlfs18) == \"EDAGE\"]   <- \"edage\"\nnames(qlfs18)[names(qlfs18) == \"HOURPAY\"] <- \"hourpay\"\nnames(qlfs18)[names(qlfs18) == \"AGE\"]     <- \"age\"\n\n# Plot a histogram of hourpay (with 30 bins)\nggplot(qlfs18, aes(x = hourpay)) +\n  geom_histogram(binwidth = 30)\n\n# Due to asymmetric distribution use ln(hourpay)\nqlfs18 <- qlfs18 %>%\n  mutate(lhourpay = log(hourpay))\n```\n"},"formats":{"html":{"identifier":{"display-name":"HTML","target-format":"html","base-format":"html"},"execute":{"fig-width":7,"fig-height":5,"fig-format":"retina","fig-dpi":96,"df-print":"default","error":false,"eval":true,"cache":null,"freeze":"auto","echo":true,"output":true,"warning":false,"include":true,"keep-md":false,"keep-ipynb":false,"ipynb":null,"enabled":null,"daemon":null,"daemon-restart":false,"debug":false,"ipynb-filters":[],"ipynb-shell-interactivity":null,"plotly-connected":true,"message":false,"engine":"knitr"},"render":{"keep-tex":false,"keep-typ":false,"keep-source":false,"keep-hidden":false,"prefer-html":false,"output-divs":true,"output-ext":"html","fig-align":"default","fig-pos":null,"fig-env":null,"code-fold":true,"code-overflow":"scroll","code-link":false,"code-line-numbers":false,"code-tools":false,"tbl-colwidths":"auto","merge-includes":true,"inline-includes":false,"preserve-yaml":false,"latex-auto-mk":true,"latex-auto-install":true,"latex-clean":true,"latex-min-runs":1,"latex-max-runs":10,"latex-makeindex":"makeindex","latex-makeindex-opts":[],"latex-tlmgr-opts":[],"latex-input-paths":[],"latex-output-dir":null,"link-external-icon":false,"link-external-newwindow":false,"self-contained-math":false,"format-resources":[],"notebook-links":true},"pandoc":{"standalone":true,"wrap":"none","default-image-extension":"png","to":"html","toc":true,"toc-depth":3,"number-sections":true,"css":["styles.css"],"output-file":"week01_advanced_interactive.html"},"language":{"toc-title-document":"Table of contents","toc-title-website":"On this page","related-formats-title":"Other Formats","related-notebooks-title":"Notebooks","source-notebooks-prefix":"Source","other-links-title":"Other Links","code-links-title":"Code Links","launch-dev-container-title":"Launch Dev Container","launch-binder-title":"Launch Binder","article-notebook-label":"Article Notebook","notebook-preview-download":"Download Notebook","notebook-preview-download-src":"Download Source","notebook-preview-back":"Back to Article","manuscript-meca-bundle":"MECA Bundle","section-title-abstract":"Abstract","section-title-appendices":"Appendices","section-title-footnotes":"Footnotes","section-title-references":"References","section-title-reuse":"Reuse","section-title-copyright":"Copyright","section-title-citation":"Citation","appendix-attribution-cite-as":"For attribution, please cite this work as:","appendix-attribution-bibtex":"BibTeX citation:","appendix-view-license":"View License","title-block-author-single":"Author","title-block-author-plural":"Authors","title-block-affiliation-single":"Affiliation","title-block-affiliation-plural":"Affiliations","title-block-published":"Published","title-block-modified":"Modified","title-block-keywords":"Keywords","callout-tip-title":"Tip","callout-note-title":"Note","callout-warning-title":"Warning","callout-important-title":"Important","callout-caution-title":"Caution","code-summary":"Code","code-tools-menu-caption":"Code","code-tools-show-all-code":"Show All Code","code-tools-hide-all-code":"Hide All Code","code-tools-view-source":"View Source","code-tools-source-code":"Source Code","tools-share":"Share","tools-download":"Download","code-line":"Line","code-lines":"Lines","copy-button-tooltip":"Copy to Clipboard","copy-button-tooltip-success":"Copied!","repo-action-links-edit":"Edit this page","repo-action-links-source":"View source","repo-action-links-issue":"Report an issue","back-to-top":"Back to top","search-no-results-text":"No results","search-matching-documents-text":"matching documents","search-copy-link-title":"Copy link to search","search-hide-matches-text":"Hide additional matches","search-more-match-text":"more match in this document","search-more-matches-text":"more matches in this document","search-clear-button-title":"Clear","search-text-placeholder":"","search-detached-cancel-button-title":"Cancel","search-submit-button-title":"Submit","search-label":"Search","toggle-section":"Toggle section","toggle-sidebar":"Toggle sidebar navigation","toggle-dark-mode":"Toggle dark mode","toggle-reader-mode":"Toggle reader mode","toggle-navigation":"Toggle navigation","crossref-fig-title":"Figure","crossref-tbl-title":"Table","crossref-lst-title":"Listing","crossref-thm-title":"Theorem","crossref-lem-title":"Lemma","crossref-cor-title":"Corollary","crossref-prp-title":"Proposition","crossref-cnj-title":"Conjecture","crossref-def-title":"Definition","crossref-exm-title":"Example","crossref-exr-title":"Exercise","crossref-ch-prefix":"Chapter","crossref-apx-prefix":"Appendix","crossref-sec-prefix":"Section","crossref-eq-prefix":"Equation","crossref-lof-title":"List of Figures","crossref-lot-title":"List of Tables","crossref-lol-title":"List of Listings","environment-proof-title":"Proof","environment-remark-title":"Remark","environment-solution-title":"Solution","listing-page-order-by":"Order By","listing-page-order-by-default":"Default","listing-page-order-by-date-asc":"Oldest","listing-page-order-by-date-desc":"Newest","listing-page-order-by-number-desc":"High to Low","listing-page-order-by-number-asc":"Low to High","listing-page-field-date":"Date","listing-page-field-title":"Title","listing-page-field-description":"Description","listing-page-field-author":"Author","listing-page-field-filename":"File Name","listing-page-field-filemodified":"Modified","listing-page-field-subtitle":"Subtitle","listing-page-field-readingtime":"Reading Time","listing-page-field-wordcount":"Word Count","listing-page-field-categories":"Categories","listing-page-minutes-compact":"{0} min","listing-page-category-all":"All","listing-page-no-matches":"No matching items","listing-page-words":"{0} words","listing-page-filter":"Filter","draft":"Draft"},"metadata":{"lang":"en","fig-responsive":true,"quarto-version":"1.6.42","theme":"cosmo","title":"Classical Linear Regression Model & Ordinary Least Squares"},"extensions":{"book":{"multiFile":true}}}},"projectFormats":["html","pdf"]}